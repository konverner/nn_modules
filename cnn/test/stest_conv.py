from convolution import Conv1d


def test_conv1d_1x1x3():
    input = [[1,  2, 10,  5,  7,  6,  5,  5]]
    kernel = [[[-0.3653409 , -0.46296853, -0.3945402 ]]]
    output = [[-4.97388613, -7.24547011, -8.81763077, -7.40552598, -7.36629695, -6.50878823]]

    conv = Conv1d(1, 1, 3, stride=1)
    conv.set_kernel(kernel)
    assert abs((output - conv(input)).sum()) < 1e-5, "wrong answer"


def test_conv1d_3x3x3():
    input = [[ 1, 2,10, 5, 7, 6, 5, 5],
             [ 1, 1, 1, 2, 2, 3, 3, 4],
             [ 2, 2, 1, 2, 3, 3, 2, 1]]
    kernel = [[[-0.01591857, 0.18612044, -0.08517794],
               [-0.19019163, -0.11414763, -0.24902496],
               [0.11887749, 0.25801343, -0.31381345]],
              [[0.0774169, 0.17219727, 0.06044313],
               [-0.11870822, 0.17398071, 0.17517106],
               [0.12464242, -0.0585738, -0.08826709]],
              [[0.03566031, -0.0588847, -0.09933369],
               [0.21306896, 0.28646654, -0.03299912],
               [-0.07463229, 0.0048641, -0.01990275]]]
    output = [[-0.41820958,-0.3314649, -0.8998286],
              [ 1.2404108,  2.4615645,  2.1682918],
              [ 0.5013268, -0.3061378,  0.36788523]]

    conv = Conv1d(3, 3, 3, stride=2)
    conv.set_kernel(kernel)
    assert abs((output - conv(input)).sum()) < 1e-5, "wrong answer"
