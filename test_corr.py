from correlation import Corr1d


def test_corr1d_1x1x3():
    input = [[1, 2, 10, 5, 7, 6, 5, 5]]
    kernel = [[[0.39248803, -0.41867903, -0.30822894]]]
    output = [[-3.52715942, -4.94295892, -0.3261174, -2.81768668, -1.30580264, -1.27961165]]

    corr = Corr1d(1, 1, 3, stride=1)
    corr.set_kernel(kernel)
    assert abs((output - corr(input)).sum()) < 1e-5, "wrong answer"


def test_corr1d_3x3x3():
    input = [[1, 2, 10, 5, 7, 6, 5, 5],
             [1, 1, 1, 2, 2, 3, 3, 4],
             [2, 2, 1, 2, 3, 3, 2, 1]]
    kernel = [[[-0.22587657, -0.22879839, -0.19446728],
               [-0.11409914, -0.26309365, 0.27948996],
               [-0.06615468, 0.28679892, 0.1038607]],
              [[-0.28226566, 0.23067841, -0.09171494],
               [-0.12777536, -0.27669019, -0.3313869],
               [0.09537022, -0.07281463, 0.12977438]],
              [[-0.2735545, 0.24747638, -0.24468458],
               [-0.05755778, 0.06962323, 0.17208394],
               [0.26910347, 0.3036531, -0.26430738]]]
    output = [[-2.18069976, -2.77402142],
              [-1.29902513, -1.78834118],
              [-1.16009238, 0.0930815]]

    corr = Corr1d(3, 3, 3, stride=3)
    corr.set_kernel(kernel)
    assert abs((output - corr(input)).sum()) < 1e-5, "wrong answer"
